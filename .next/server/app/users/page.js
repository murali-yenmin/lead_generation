(()=>{var e={};e.id=5009,e.ids=[5009],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4173:(e,s,a)=>{Promise.resolve().then(a.bind(a,88855))},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},12412:e=>{"use strict";e.exports=require("assert")},14103:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>r});let r=(0,a(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"D:\\\\murali\\\\lead_generation\\\\src\\\\app\\\\users\\\\page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"D:\\murali\\lead_generation\\src\\app\\users\\page.tsx","default")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},53367:(e,s,a)=>{"use strict";a.r(s),a.d(s,{GlobalError:()=>i.a,__next_app__:()=>u,pages:()=>d,routeModule:()=>m,tree:()=>o});var r=a(65239),t=a(48088),n=a(88170),i=a.n(n),l=a(30893),c={};for(let e in l)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>l[e]);a.d(s,c);let o={children:["",{children:["users",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,14103)),"D:\\murali\\lead_generation\\src\\app\\users\\page.tsx"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(a.bind(a,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(a.bind(a,94431)),"D:\\murali\\lead_generation\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(a.t.bind(a,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(a.t.bind(a,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(a.bind(a,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,d=["D:\\murali\\lead_generation\\src\\app\\users\\page.tsx"],u={require:a,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:t.RouteKind.APP_PAGE,page:"/users/page",pathname:"/users",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},56909:(e,s,a)=>{Promise.resolve().then(a.bind(a,14103))},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},83997:e=>{"use strict";e.exports=require("tty")},88855:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>B});var r=a(60687),t=a(43210),n=a(97476),i=a(44493),l=a(96834),c=a(17612),o=a(11516),d=a(81740),u=a(85309),m=a(93090),x=a(69795),h=a(76311);let p=(0,a(82614).A)("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);var j=a(48206),g=a(14975),v=a(32584),b=a(43010),f=a(54864),y=a(98949),C=a(62622),N=a(99825),A=a(27605),w=a(63442),_=a(43214);a(45314);var k=a(29523),P=a(63503),q=a(71669),z=a(89667),I=a(15079),$=a(29867),U=a(35265);let M=_.Ik({name:_.Yj().min(2,{message:"Name must be at least 2 characters."}),email:_.Yj().email({message:"Please enter a valid email address."}),organizationId:_.Yj().min(1,{message:"Please select an organization."}),roleId:_.Yj().min(1,{message:"Please select a role."}),teamId:_.Yj().optional()});function S({open:e,onOpenChange:s,onUserAdded:a,currentUser:n}){let i=(0,f.wA)(),{toast:l}=(0,$.dj)(),{organizations:c,teams:d,status:u}=(0,f.d4)(e=>e.users),{roles:m}=(0,f.d4)(e=>e.settings),[x,h]=(0,t.useState)(""),p=(0,A.mN)({resolver:(0,w.u)(M),defaultValues:{name:"",email:"",organizationId:"",roleId:"",teamId:""}}),j=n?.roleName==="Super Admin",g=m.find(e=>e.name===n?.roleName),v=g?.level||0,b=m?m.filter(e=>e.level<v):[],y=p.watch("organizationId"),C=async()=>{if(x.trim()&&y)try{let e=await i((0,N.gj)({organizationId:y,name:x})).unwrap();l({title:"Team Created",description:`Successfully created the "${x}" team.`,variant:"success"}),p.setValue("teamId",e._id),h("")}catch(e){l({title:"Failed to Create Team",description:e,variant:"destructive"})}},_=async e=>{try{await i((0,N.nu)(e)).unwrap(),l({title:"User Created",description:`An invitation has been sent to ${e.email}.`,variant:"success"}),a()}catch(e){l({title:"Failed to Create User",description:e,variant:"destructive"})}};return(0,r.jsx)(P.lG,{open:e,onOpenChange:s,children:(0,r.jsxs)(P.Cf,{className:"sm:max-w-[425px]",children:[(0,r.jsxs)(P.c7,{children:[(0,r.jsx)(P.L3,{children:"Add New User"}),(0,r.jsx)(P.rr,{children:"Enter the details below to invite a new user to the platform."})]}),(0,r.jsx)(q.lV,{...p,children:(0,r.jsxs)("form",{onSubmit:p.handleSubmit(_),className:"space-y-4 py-4",children:[(0,r.jsx)(q.zB,{control:p.control,name:"name",render:({field:e})=>(0,r.jsxs)(q.eI,{children:[(0,r.jsx)(q.lR,{children:"Full Name"}),(0,r.jsx)(q.MJ,{children:(0,r.jsx)(z.p,{placeholder:"John Doe",...e})}),(0,r.jsx)(q.C5,{})]})}),(0,r.jsx)(q.zB,{control:p.control,name:"email",render:({field:e})=>(0,r.jsxs)(q.eI,{children:[(0,r.jsx)(q.lR,{children:"Email Address"}),(0,r.jsx)(q.MJ,{children:(0,r.jsx)(z.p,{placeholder:"john.doe@example.com",...e})}),(0,r.jsx)(q.C5,{})]})}),(0,r.jsx)(q.zB,{control:p.control,name:"organizationId",render:({field:e})=>(0,r.jsxs)(q.eI,{children:[(0,r.jsx)(q.lR,{children:"Organization"}),(0,r.jsxs)(I.l6,{onValueChange:e.onChange,value:e.value,disabled:!j,children:[(0,r.jsx)(q.MJ,{children:(0,r.jsx)(I.bq,{children:(0,r.jsx)(I.yv,{placeholder:"Select an organization"})})}),(0,r.jsx)(I.gC,{children:c.map(e=>(0,r.jsx)(I.eb,{value:e._id,children:e.name},e._id))})]}),(0,r.jsx)(q.C5,{})]})}),(0,r.jsx)(q.zB,{control:p.control,name:"roleId",render:({field:e})=>(0,r.jsxs)(q.eI,{children:[(0,r.jsx)(q.lR,{children:"Role"}),(0,r.jsxs)(I.l6,{onValueChange:e.onChange,value:e.value,children:[(0,r.jsx)(q.MJ,{children:(0,r.jsx)(I.bq,{children:(0,r.jsx)(I.yv,{placeholder:"Select a role"})})}),(0,r.jsx)(I.gC,{children:b.map(e=>(0,r.jsx)(I.eb,{value:e._id,children:e.name},e._id))})]}),(0,r.jsx)(q.C5,{})]})}),(0,r.jsx)(q.zB,{control:p.control,name:"teamId",render:({field:e})=>(0,r.jsxs)(q.eI,{children:[(0,r.jsx)(q.lR,{children:"Team (Optional)"}),(0,r.jsxs)(I.l6,{onValueChange:s=>e.onChange("no-team"===s?"":s),value:e.value||"no-team",disabled:!y,children:[(0,r.jsx)(q.MJ,{children:(0,r.jsx)(I.bq,{children:(0,r.jsx)(I.yv,{placeholder:"Select a team"})})}),(0,r.jsxs)(I.gC,{children:[(0,r.jsx)(I.eb,{value:"no-team",children:"No Team"}),d.map(e=>(0,r.jsx)(I.eb,{value:e._id,children:e.name},e._id)),(0,r.jsx)("div",{className:"p-2 mt-2 border-t",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(z.p,{placeholder:"New team name...",value:x,onChange:e=>h(e.target.value),className:"flex-1"}),(0,r.jsxs)(k.$,{type:"button",size:"sm",onClick:C,disabled:!x.trim(),children:[(0,r.jsx)(U.A,{className:"mr-2 size-4"})," Add"]})]})})]})]}),(0,r.jsx)(q.C5,{})]})}),(0,r.jsxs)(P.Es,{children:[(0,r.jsx)(k.$,{type:"button",variant:"ghost",onClick:()=>s(!1),children:"Cancel"}),(0,r.jsxs)(k.$,{type:"submit",disabled:"loading"===u,children:["loading"===u&&(0,r.jsx)(o.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Invite User"]})]})]})})]})})}var R=a(21342),E=a(55925),D=a(16189);let F=e=>e.split(" ").map(e=>e[0]).join("").toUpperCase();function B(){let e=(0,f.wA)(),s=(0,D.useRouter)(),{toast:a}=(0,$.dj)(),{users:A,totalUsers:w,page:_,limit:P,searchTerm:q,roleFilter:z,statusFilter:I,isLoading:U,updatingUserId:M,error:B}=(0,f.d4)(e=>e.users),{user:O,token:T}=(0,f.d4)(e=>e.auth),{roles:V}=(0,f.d4)(e=>e.settings),[G,J]=(0,t.useState)(!1),[K,L]=(0,t.useState)(null),[Y]=(0,n.d7)(q,500),Z=Math.ceil(w/P),H=(0,t.useMemo)(()=>V.map(e=>e.name),[V]),Q=async()=>{if(!K)return;let{user:s,action:r}=K,t="activate"===r?"active":"deactivated",n=await e((0,N.pU)({userId:s._id,status:t}));if(N.pU.fulfilled.match(n)){let e=r.charAt(0).toUpperCase()+r.slice(1);a({title:`User ${e}d`,description:`${s.name}'s account has been successfully ${e.toLowerCase()}d.`,variant:"success"})}else a({title:"Action Failed",description:n.payload||`Failed to ${r} ${s.name}. Please try again.`,variant:"destructive"});L(null)},W=e=>{s.push(`/users/${e._id}`)},X=(0,t.useMemo)(()=>[{accessorKey:"name",header:"User",cell:({row:e})=>{let s=e.original,a=s.image&&s.image[0]?s.image[0].url:null;return(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsxs)(v.eu,{children:[a&&(0,r.jsx)(v.BK,{src:a}),(0,r.jsx)(v.q5,{children:F(s.name)})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium",children:s.name}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:s.email})]})]})}},{accessorKey:"organizationName",header:"Organization",cell:({row:e})=>(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(c.A,{className:"size-4 text-muted-foreground"}),(0,r.jsx)("span",{children:e.original.organizationName||"N/A"})]})},{accessorKey:"roleName",header:"Role",cell:({row:e})=>(0,r.jsx)(l.E,{variant:"outline",children:e.original.roleName||"N/A"})},{accessorKey:"status",header:"Status",cell:({row:e})=>{let s=e.original;if(M===s._id)return(0,r.jsxs)(l.E,{variant:"outline",className:"animate-pulse",children:[(0,r.jsx)(o.A,{className:"mr-1.5 animate-spin"}),"Updating..."]});let a={active:{variant:"secondary",icon:d.A,label:"Active",className:"bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300"},pending:{variant:"default",icon:u.A,label:"Pending",className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/50 dark:text-yellow-300"},deactivated:{variant:"destructive",icon:m.A,label:"Deactivated",className:"bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300"}},{variant:t,icon:n,label:i,className:c}=a[s.status]||a.pending;return(0,r.jsxs)(l.E,{variant:t,className:c,children:[(0,r.jsx)(n,{className:"mr-1.5"}),i]})}},{accessorKey:"createdAt",header:"Date Joined",cell:({row:e})=>(0,b.GP)(new Date(e.original.createdAt),"PPP")},{id:"actions",header:"",cell:({row:e})=>{let s=e.original,a="Super Admin"===s.roleName,t="active"===s.status,n=M===s._id;return(0,r.jsxs)(R.rI,{children:[(0,r.jsx)(R.ty,{asChild:!0,children:(0,r.jsxs)(k.$,{variant:"ghost",className:"h-8 w-8 p-0",disabled:n,children:[(0,r.jsx)("span",{className:"sr-only",children:"Open menu"}),(0,r.jsx)(x.A,{className:"h-4 w-4"})]})}),(0,r.jsxs)(R.SQ,{align:"end",children:[(0,r.jsx)(R.lp,{children:"Actions"}),(0,r.jsxs)(R._2,{onClick:()=>W(s),children:[(0,r.jsx)(h.A,{className:"mr-2 h-4 w-4"}),"View"]}),!a&&(0,r.jsx)(R.mB,{}),!a&&(0,r.jsx)(r.Fragment,{children:t?(0,r.jsxs)(R._2,{onClick:()=>L({user:s,action:"deactivate"}),className:"text-destructive focus:bg-destructive/10 focus:text-destructive",children:[(0,r.jsx)(m.A,{className:"mr-2 h-4 w-4"}),"Deactivate Account"]}):(0,r.jsxs)(R._2,{onClick:()=>L({user:s,action:"activate"}),className:"text-green-600 focus:bg-green-500/10 focus:text-green-700 dark:text-green-400 dark:focus:text-green-400",children:[(0,r.jsx)(p,{className:"mr-2 h-4 w-4"}),"Activate Account"]})})]})]})}}],[H,s,M]),ee=(0,t.useMemo)(()=>[{value:"all",label:"All Roles"},...H.map(e=>({value:e,label:e}))],[H]),es=(0,t.useMemo)(()=>[{value:"all",label:"All Statuses"},{value:"active",label:"Active"},{value:"pending",label:"Pending"},{value:"deactivated",label:"Deactivated"}],[]),ea=K?.action||"deactivate",er=ea.charAt(0).toUpperCase()+ea.slice(1),et=`${er} Account?`,en=`This will ${ea} the account for ${K?.user.name} (${K?.user.email}). They will ${"deactivate"===ea?"lose all":"regain"} access to the platform. Are you sure?`;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("main",{className:"flex flex-1 flex-col gap-6 p-4 sm:px-6 md:gap-8 md:p-8",children:(0,r.jsxs)(i.Zp,{children:[(0,r.jsxs)(i.aR,{children:[(0,r.jsxs)(i.ZB,{className:"flex items-center gap-2 text-2xl font-headline",children:[(0,r.jsx)(j.A,{className:"size-8"}),"User Management"]}),(0,r.jsx)(i.BT,{children:"View, search, and manage all users in your organization."})]}),(0,r.jsx)(i.Wu,{children:(0,r.jsx)(y.b,{columns:X,data:A,isLoading:U,error:B,pageCount:Z,currentPage:_,onPageChange:s=>e((0,N.Ir)(s)),currentLimit:P,onLimitChange:s=>e((0,N.aF)(s)),children:(0,r.jsx)(C.w,{searchTerm:q,onSearchChange:s=>e((0,N.NM)(s)),filters:[{value:z,onChange:s=>e((0,N.Hd)(s)),placeholder:"Filter by role",options:ee},{value:I,onChange:s=>e((0,N.V5)(s)),placeholder:"Filter by status",options:es}],actions:[{label:"Add user",onClick:()=>J(!0)}]})})})]})}),(0,r.jsx)(S,{open:G,onOpenChange:J,onUserAdded:()=>{J(!1),e((0,N.hU)())},currentUser:O}),(0,r.jsx)(E.Lt,{open:!!K,onOpenChange:e=>!e&&L(null),children:(0,r.jsxs)(E.EO,{children:[(0,r.jsxs)(E.wd,{children:[(0,r.jsxs)(E.r7,{className:"flex items-center gap-2",children:[(0,r.jsx)(g.A,{className:"deactivate"===ea?"text-destructive":"text-green-500"}),et]}),(0,r.jsx)(E.$v,{children:en})]}),(0,r.jsxs)(E.ck,{children:[(0,r.jsx)(E.Zr,{children:"Cancel"}),(0,r.jsx)(E.Rx,{onClick:Q,className:"deactivate"===ea?"bg-destructive hover:bg-destructive/90 text-destructive-foreground":"bg-green-600 hover:bg-green-600/90 text-white",children:er})]})]})})]})}},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")}};var s=require("../../webpack-runtime.js");s.C(e);var a=e=>s(s.s=e),r=s.X(0,[4447,6724,5744,1658,4136,676,9080,353,348,4220],()=>a(53367));module.exports=r})();