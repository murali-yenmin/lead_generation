(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[469],{19637:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});let n=(0,a(40157).A)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]])},22346:(e,t,a)=>{"use strict";a.d(t,{w:()=>i});var n=a(95155),s=a(12115),r=a(87489),l=a(59434);let i=s.forwardRef((e,t)=>{let{className:a,orientation:s="horizontal",decorative:i=!0,...c}=e;return(0,n.jsx)(r.b,{ref:t,decorative:i,orientation:s,className:(0,l.cn)("shrink-0 bg-border","horizontal"===s?"h-[1px] w-full":"h-full w-[1px]",a),...c})});i.displayName=r.b.displayName},26328:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>K});var n=a(95155),s=a(12115),r=a(62177),l=a(90221),i=a(70927),c=a(30285),d=a(66695),o=a(62523),h=a(85057),p=a(87481),m=a(16923),u=a(25318),x=a(73503),j=a(50172),y=a(19637),v=a(40157);let g=(0,v.A)("Pilcrow",[["path",{d:"M13 4v16",key:"8vvj80"}],["path",{d:"M17 4v16",key:"7dpous"}],["path",{d:"M19 4H9.5a4.5 4.5 0 0 0 0 9H13",key:"sh4n9v"}]]),k=(0,v.A)("Heading1",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"m17 12 3-2v8",key:"1hhhft"}]]),f=(0,v.A)("Heading2",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M21 18h-4c0-4 4-3 4-6 0-1.5-2-2.5-4-1",key:"9jr5yi"}]]),b=(0,v.A)("Heading3",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M17.5 10.5c1.7-1 3.5 0 3.5 1.5a2 2 0 0 1-2 2",key:"68ncm8"}],["path",{d:"M17 17.5c2 1.5 4 .3 4-1.5a2 2 0 0 0-2-2",key:"1ejuhz"}]]),N=(0,v.A)("Heading4",[["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M17 10v3a1 1 0 0 0 1 1h3",key:"tj5zdr"}],["path",{d:"M21 10v8",key:"1kdml4"}],["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}]]),C=(0,v.A)("Heading5",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M17 13v-3h4",key:"1nvgqp"}],["path",{d:"M17 17.7c.4.2.8.3 1.3.3 1.5 0 2.7-1.1 2.7-2.5S19.8 13 18.3 13H17",key:"2nebdn"}]]),w=(0,v.A)("Heading6",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["circle",{cx:"19",cy:"16",r:"2",key:"15mx69"}],["path",{d:"M20 10c-2 2-3 3.5-3 6",key:"f35dl0"}]]),M=(0,v.A)("Bold",[["path",{d:"M6 12h9a4 4 0 0 1 0 8H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h7a4 4 0 0 1 0 8",key:"mg9rjx"}]]),z=(0,v.A)("Italic",[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]]),A=(0,v.A)("Underline",[["path",{d:"M6 4v6a6 6 0 0 0 12 0V4",key:"9kb039"}],["line",{x1:"4",x2:"20",y1:"20",y2:"20",key:"nun2al"}]]),R=(0,v.A)("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]),S=(0,v.A)("ListOrdered",[["path",{d:"M10 12h11",key:"6m4ad9"}],["path",{d:"M10 18h11",key:"11hvi2"}],["path",{d:"M10 6h11",key:"c7qv1k"}],["path",{d:"M4 10h2",key:"16xx2s"}],["path",{d:"M4 6h1v4",key:"cnovpq"}],["path",{d:"M6 18H4c0-1 2-2 2-3s-1-1.5-2-1",key:"m9a95d"}]]);var E=a(17832);let V=(0,v.A)("Paperclip",[["path",{d:"M13.234 20.252 21 12.3",key:"1cbrk9"}],["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 0 2.828 2 2 0 0 0 2.828 0l8.414-8.586a4 4 0 0 0 0-5.656 4 4 0 0 0-5.656 0l-8.415 8.585a6 6 0 1 0 8.486 8.486",key:"1pkts6"}]]);var q=a(73672),H=a(26126),T=a(66424),B=a(22346),I=a(34477);let L=(0,I.createServerReference)("40ca85d64187cc14c957f4a2643ddf635e525cd233",I.callServer,void 0,I.findSourceMapURL,"generateEmailContent");var O=a(54165),Y=a(88539),$=a(59409),F=a(59434),G=a(17759),P=a(80722);async function U(e){try{var t;console.log(e,"input ====");let a=await P.A.post("/api/n8n/emailSender",e);return{success:!0,messageId:(null==a||null==(t=a.data)?void 0:t.messageId)||""}}catch(e){throw console.error("Error calling n8n email webhook:",e),e}}let J=e=>{let{id:t,label:a,placeholder:r,recipients:l,onRecipientsChange:i,allowCsvUpload:d=!1,error:x}=e,[j,y]=(0,s.useState)(""),v=(0,s.useRef)(null),{toast:g}=(0,p.dj)(),k=e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),f=()=>{let e=j.trim();e&&!l.includes(e)&&(k(e)?(i([...l,e]),y("")):g({variant:"destructive",title:"Invalid Email",description:'"'.concat(e,'" is not a valid email address.')}))},b=e=>{i(l.filter((t,a)=>a!==e))};return(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(h.J,{htmlFor:t,className:(0,F.cn)(x&&"text-destructive"),children:a}),(0,n.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)(o.p,{id:t,type:"email",placeholder:r,value:j,onChange:e=>{y(e.target.value)},onKeyDown:e=>{("Enter"===e.key||","===e.key)&&(e.preventDefault(),f())},onBlur:f,className:(0,F.cn)(x&&"border-destructive")}),d&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(c.$,{type:"button",variant:"outline",onClick:()=>{var e;return null==(e=v.current)?void 0:e.click()},children:[(0,n.jsx)(m.A,{className:"mr-2 h-4 w-4"}),"Upload CSV"]}),(0,n.jsx)("input",{type:"file",ref:v,className:"sr-only",accept:".csv",onChange:e=>{var t;let n=null==(t=e.target.files)?void 0:t[0];if(n&&"text/csv"===n.type){let e=new FileReader;e.onload=e=>{var t;let n=(null==(t=e.target)?void 0:t.result).split("\n").filter(e=>""!==e.trim()).flatMap(e=>e.split(",").map(e=>e.trim()).filter(Boolean)),s=n.filter(k),r=n.filter(e=>!k(e)),c=s.filter(e=>!l.includes(e));i([...l,...c]),r.length>0&&g({variant:"warning",title:"Some emails were invalid",description:"Could not import: ".concat(r.join(", "))}),c.length>0?g({variant:"success",title:"Import Successful",description:"".concat(c.length," new email(s) added to ").concat(a,".")}):g({variant:"info",title:"No new emails",description:"All emails from the file were already in the list or invalid."})},e.readAsText(n)}else g({variant:"destructive",title:"Invalid File Type",description:"Please upload a .csv file."});v.current&&(v.current.value="")}})]})]}),x&&(0,n.jsx)("p",{className:"text-sm font-medium text-destructive",children:x}),l.length>0&&(0,n.jsx)(T.F,{className:"h-20 w-full rounded-md border",children:(0,n.jsx)("div",{className:"p-2 space-x-1 space-y-1",children:l.map((e,t)=>(0,n.jsxs)(H.E,{variant:"secondary",className:"text-sm font-normal gap-1 pl-2 pr-1",children:[e,(0,n.jsxs)("button",{onClick:()=>b(t),className:"rounded-full hover:bg-background/50 p-0.5",children:[(0,n.jsx)(u.A,{className:"size-3"}),(0,n.jsxs)("span",{className:"sr-only",children:["Remove ",e]})]})]},t))})})]})]})};function _(e){let{open:t,onOpenChange:a,onGenerate:r,isGenerating:l}=e,[i,d]=(0,s.useState)(""),o=async()=>{await r(i),a(!1),d("")};return(0,n.jsx)(O.lG,{open:t,onOpenChange:a,children:(0,n.jsxs)(O.Cf,{children:[(0,n.jsxs)(O.c7,{children:[(0,n.jsxs)(O.L3,{className:"flex items-center gap-2",children:[(0,n.jsx)(x.A,{className:"size-5"})," AI Email Generator"]}),(0,n.jsx)(O.rr,{children:"Describe the email you want."})]}),(0,n.jsx)("div",{className:"py-4",children:(0,n.jsx)(Y.T,{id:"ai-prompt-dialog",placeholder:"e.g., 'An email to our beta users announcing a new feature that allows them to export their data. The tone should be excited and thankful.'",className:"min-h-[150px] resize-none",value:i,onChange:e=>d(e.target.value),disabled:l})}),(0,n.jsxs)(O.Es,{children:[(0,n.jsx)(c.$,{variant:"ghost",onClick:()=>a(!1),disabled:l,children:"Cancel"}),(0,n.jsxs)(c.$,{onClick:o,disabled:l||!i.trim(),children:[l&&(0,n.jsx)(j.A,{className:"mr-2 h-4 w-4 animate-spin"}),l?"Generating...":"Generate Email"]})]})]})})}let D=i.Ik({toRecipients:i.YO(i.Yj().email()).min(1,{message:"Please add at least one recipient."}),ccRecipients:i.YO(i.Yj().email()).optional(),bccRecipients:i.YO(i.Yj().email()).optional(),replyToRecipients:i.YO(i.Yj().email()).optional(),subject:i.Yj().min(1,{message:"Subject is required."}),senderName:i.Yj().optional(),replyToSenderOnly:i.zM().optional(),attachments:i.bz().optional(),emailContent:i.Yj().min(1,{message:"Email content cannot be empty."})});function K(){let[e,t]=(0,s.useState)([]),a=(0,s.useRef)(null),{toast:i}=(0,p.dj)(),[,m]=(0,s.useReducer)(e=>e+1,0),[x,v]=(0,s.useState)(!1),[H,T]=(0,s.useState)(!1),[I,O]=(0,s.useState)(!1),[Y,P]=(0,s.useState)(!1),K=(0,r.mN)({resolver:(0,l.u)(D),mode:"onChange",defaultValues:{toRecipients:[],ccRecipients:[],bccRecipients:[],replyToRecipients:[],subject:"",senderName:"",replyToSenderOnly:!1,emailContent:""}}),Z=(0,s.useRef)(null),[W,Q]=(0,s.useState)("p"),X=e=>{let t=e.currentTarget.innerHTML;K.setValue("emailContent","<p><br></p>"===t||"<br>"===t?"":t,{shouldValidate:!0}),O(!0)},ee=(e,t)=>{if(document.execCommand(e,!1,t),a.current){a.current.focus();let e=new Event("input",{bubbles:!0});a.current.dispatchEvent(e),m()}},et=e=>{if(document.queryCommandState)try{return document.queryCommandState(e)}catch(e){}return!1},ea=()=>{if(document){let e=document.queryCommandValue("formatBlock").toLowerCase();["h1","h2","h3","h4","h5","h6","p"].includes(e)?Q(e):Q("p")}};(0,s.useEffect)(()=>{if(!a.current)return;let e=()=>{ea(),m()};return document.addEventListener("selectionchange",e),()=>{document.removeEventListener("selectionchange",e)}},[]);let en=async e=>{P(!0);try{let t=await U(e);console.log(t,"result"),t&&i({variant:"success",title:"Email Sent!",description:"Your email has been successfully sent."}),P(!1)}catch(e){console.error("Error generating post:",e),i({variant:"destructive",title:"An error occurred",description:"Failed to generate post. Please try again."}),P(!1)}},es=async e=>{if(!e.trim())return void i({variant:"destructive",title:"Empty Prompt",description:"Please provide a prompt for the AI to generate an email."});v(!0);try{let t=await L({prompt:e});K.setValue("emailContent",t.emailContent,{shouldValidate:!0}),a.current&&(a.current.innerHTML=t.emailContent),O(!1),i({variant:"success",title:"Email Content Generated",description:"The AI has drafted an email for you."})}catch(e){console.error("Error generating email:",e),i({variant:"destructive",title:"Generation Failed",description:"There was an error generating the email content."})}finally{v(!1)}},er=e=>{e.target.files&&t(t=>[...t,...Array.from(e.target.files)])},el=e=>{t(t=>t.filter((t,a)=>a!==e))};return K.watch("emailContent"),(0,n.jsxs)("main",{className:"flex flex-1 flex-col gap-6 p-4 sm:px-6 md:gap-8 md:p-8",children:[(0,n.jsx)(G.lV,{...K,children:(0,n.jsx)("form",{onSubmit:K.handleSubmit(en),children:(0,n.jsxs)(d.Zp,{children:[(0,n.jsxs)(d.aR,{children:[(0,n.jsxs)(d.ZB,{className:"flex items-center gap-2 text-2xl font-headline",children:[(0,n.jsx)(y.A,{className:"size-8"}),"Email Composer"]}),(0,n.jsx)(d.BT,{children:"Craft and send emails to your audience. Use the AI generator or write your own."})]}),(0,n.jsx)(d.Wu,{className:"space-y-6",children:(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)(G.zB,{control:K.control,name:"toRecipients",render:e=>{var t;let{field:a,fieldState:s}=e;return(0,n.jsx)(J,{id:"to-recipients",label:"To",placeholder:"Add 'To' recipients...",recipients:a.value||[],onRecipientsChange:a.onChange,allowCsvUpload:!0,error:null==(t=s.error)?void 0:t.message})}}),(0,n.jsx)(G.zB,{control:K.control,name:"subject",render:e=>{let{field:t}=e;return(0,n.jsxs)(G.eI,{children:[(0,n.jsx)(G.lR,{children:"Subject"}),(0,n.jsx)(G.MJ,{children:(0,n.jsx)(o.p,{id:"subject",placeholder:"Your email subject",...t})}),(0,n.jsx)(G.C5,{})]})}}),(0,n.jsx)(G.zB,{control:K.control,name:"ccRecipients",render:e=>{let{field:t}=e;return(0,n.jsx)(J,{id:"cc-recipients",label:"CC",placeholder:"Add 'CC' recipients...",recipients:t.value||[],onRecipientsChange:t.onChange})}}),(0,n.jsx)(G.zB,{control:K.control,name:"bccRecipients",render:e=>{let{field:t}=e;return(0,n.jsx)(J,{id:"bcc-recipients",label:"BCC",placeholder:"Add 'BCC' recipients...",recipients:t.value||[],onRecipientsChange:t.onChange})}}),(0,n.jsx)(G.zB,{control:K.control,name:"senderName",render:e=>{let{field:t}=e;return(0,n.jsxs)(G.eI,{children:[(0,n.jsx)(G.lR,{children:"Sender Name (Optional)"}),(0,n.jsx)(G.MJ,{children:(0,n.jsx)(o.p,{id:"sender-name",placeholder:"e.g., John Doe",...t})}),(0,n.jsx)(G.C5,{})]})}}),(0,n.jsx)(G.zB,{control:K.control,name:"replyToRecipients",render:e=>{let{field:t}=e;return(0,n.jsx)(J,{id:"reply-to-recipients",label:"Send Replies To (Optional)",placeholder:"Add reply-to addresses...",recipients:t.value||[],onRecipientsChange:t.onChange})}})]}),(0,n.jsx)("div",{className:"space-y-4",children:(0,n.jsx)(G.zB,{control:K.control,name:"emailContent",render:t=>{let{field:s,fieldState:r}=t;return(0,n.jsxs)(G.eI,{children:[(0,n.jsx)(G.lR,{children:"Email Content"}),(0,n.jsxs)("div",{className:(0,F.cn)("rounded-md border border-input",r.error&&"border-destructive"),children:[(0,n.jsxs)("div",{className:"p-2 flex items-center space-x-1 border-b flex-wrap",children:[(0,n.jsxs)($.l6,{value:W,onValueChange:e=>ee("formatBlock",e),children:[(0,n.jsx)($.bq,{className:"w-[150px]",children:(0,n.jsx)($.yv,{placeholder:"Format"})}),(0,n.jsxs)($.gC,{children:[(0,n.jsxs)($.eb,{value:"p",children:[(0,n.jsx)(g,{className:"inline-block mr-2 h-4 w-4"})," ","Paragraph"]}),(0,n.jsxs)($.eb,{value:"h1",children:[(0,n.jsx)(k,{className:"inline-block mr-2 h-4 w-4"})," ","Heading 1"]}),(0,n.jsxs)($.eb,{value:"h2",children:[(0,n.jsx)(f,{className:"inline-block mr-2 h-4 w-4"})," ","Heading 2"]}),(0,n.jsxs)($.eb,{value:"h3",children:[(0,n.jsx)(b,{className:"inline-block mr-2 h-4 w-4"})," ","Heading 3"]}),(0,n.jsxs)($.eb,{value:"h4",children:[(0,n.jsx)(N,{className:"inline-block mr-2 h-4 w-4"})," ","Heading 4"]}),(0,n.jsxs)($.eb,{value:"h5",children:[(0,n.jsx)(C,{className:"inline-block mr-2 h-4 w-4"})," ","Heading 5"]}),(0,n.jsxs)($.eb,{value:"h6",children:[(0,n.jsx)(w,{className:"inline-block mr-2 h-4 w-4"})," ","Heading 6"]})]})]}),(0,n.jsx)(B.w,{orientation:"vertical",className:"h-6 mx-2"}),(0,n.jsx)(c.$,{type:"button",variant:et("bold")?"secondary":"ghost",size:"icon",onClick:()=>ee("bold"),children:(0,n.jsx)(M,{})}),(0,n.jsx)(c.$,{type:"button",variant:et("italic")?"secondary":"ghost",size:"icon",onClick:()=>ee("italic"),children:(0,n.jsx)(z,{})}),(0,n.jsx)(c.$,{type:"button",variant:et("underline")?"secondary":"ghost",size:"icon",onClick:()=>ee("underline"),children:(0,n.jsx)(A,{})}),(0,n.jsx)(B.w,{orientation:"vertical",className:"h-6 mx-2"}),(0,n.jsx)(c.$,{type:"button",variant:et("insertUnorderedList")?"secondary":"ghost",size:"icon",onClick:()=>ee("insertUnorderedList"),children:(0,n.jsx)(R,{})}),(0,n.jsx)(c.$,{type:"button",variant:et("insertOrderedList")?"secondary":"ghost",size:"icon",onClick:()=>ee("insertOrderedList"),children:(0,n.jsx)(S,{})}),(0,n.jsx)(B.w,{orientation:"vertical",className:"h-6 mx-2"}),(0,n.jsxs)(c.$,{type:"button",variant:"ghost",onClick:()=>T(!0),children:[(0,n.jsx)(E.A,{className:"mr-2 h-4 w-4"}),"Generate with AI"]})]}),(0,n.jsx)(G.MJ,{children:(0,n.jsx)("div",{ref:a,id:"email-content",contentEditable:!0,onInput:X,onFocus:()=>{ea(),O(!0)},onBlur:()=>O(!1),onKeyUp:ea,onMouseUp:ea,className:(0,F.cn)("prose dark:prose-invert prose-sm max-w-none h-[400px] overflow-y-auto w-full rounded-b-md bg-background px-4 py-3 text-base ring-offset-background focus-visible:outline-none disabled:cursor-not-allowed disabled:opacity-50 text-start")})}),(0,n.jsxs)("div",{className:"p-2 border-t",children:[(0,n.jsxs)(c.$,{type:"button",variant:"ghost",onClick:()=>{var e;return null==(e=Z.current)?void 0:e.click()},children:[(0,n.jsx)(V,{className:"mr-2"}),"Attach Files"]}),(0,n.jsx)("input",{type:"file",multiple:!0,ref:Z,className:"sr-only",onChange:er}),e.length>0&&(0,n.jsxs)("div",{className:"mt-2 space-y-2",children:[(0,n.jsxs)(h.J,{children:["Attachments (",e.length,")"]}),(0,n.jsx)("div",{className:"space-y-1",children:e.map((e,t)=>(0,n.jsxs)("div",{className:"flex items-center justify-between text-sm p-1.5 rounded-md bg-accent/50 group",children:[(0,n.jsx)("span",{className:"truncate",children:e.name}),(0,n.jsx)(c.$,{variant:"ghost",size:"icon",className:"h-6 w-6 shrink-0",onClick:()=>el(t),children:(0,n.jsx)(u.A,{className:"size-3.5"})})]},t))})]})]})]}),(0,n.jsx)(G.C5,{})]})}})})]})}),(0,n.jsx)(d.wL,{className:"justify-end",children:(0,n.jsxs)(c.$,{type:"submit",disabled:!K.formState.isValid||Y,children:[Y?(0,n.jsx)(j.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,n.jsx)(q.A,{className:"mr-2 h-4 w-4"}),Y?"Sending...":"Send Email"]})})]})})}),(0,n.jsx)(_,{open:H,onOpenChange:T,onGenerate:es,isGenerating:x})]})}},30457:(e,t,a)=>{Promise.resolve().then(a.bind(a,26328))},87489:(e,t,a)=>{"use strict";a.d(t,{b:()=>d});var n=a(12115),s=a(63655),r=a(95155),l="horizontal",i=["horizontal","vertical"],c=n.forwardRef((e,t)=>{var a;let{decorative:n,orientation:c=l,...d}=e,o=(a=c,i.includes(a))?c:l;return(0,r.jsx)(s.sG.div,{"data-orientation":o,...n?{role:"none"}:{"aria-orientation":"vertical"===o?o:void 0,role:"separator"},...d,ref:t})});c.displayName="Separator";var d=c}},e=>{var t=t=>e(e.s=t);e.O(0,[769,431,917,100,399,58,400,441,684,358],()=>t(30457)),_N_E=e.O()}]);