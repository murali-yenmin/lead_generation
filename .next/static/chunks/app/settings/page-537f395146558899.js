(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4662],{16674:(e,s,a)=>{"use strict";a.d(s,{Ay:()=>l,Ul:()=>n,kN:()=>t});var i=a(66439),r=a(23464);let t=(0,i.zD)("settings/fetchRoles",async(e,s)=>{let{getState:a,rejectWithValue:i}=s,{auth:{token:t}}=a();if(!t)return i("Not authenticated");try{return(await r.A.get("/api/roles",{headers:{Authorization:"Bearer ".concat(t)}})).data}catch(e){var n,l;return i((null==(l=e.response)||null==(n=l.data)?void 0:n.message)||"Failed to fetch roles.")}}),n=(0,i.zD)("settings/updateRolePermissions",async(e,s)=>{let{roleId:a,permissions:i}=e,{getState:t,rejectWithValue:n}=s,{auth:{token:l}}=t();if(!l)return n("Not authenticated");try{return(await r.A.put("/api/roles/".concat(a),{permissions:i},{headers:{Authorization:"Bearer ".concat(l)}})).data}catch(e){var d,c;return n((null==(c=e.response)||null==(d=c.data)?void 0:d.message)||"Failed to update permissions.")}}),l=(0,i.Z0)({name:"settings",initialState:{roles:[],isLoading:!1,isUpdating:!1,error:null},reducers:{},extraReducers:e=>{e.addCase(t.pending,e=>{e.isLoading=!0,e.error=null}).addCase(t.fulfilled,(e,s)=>{e.isLoading=!1,e.roles=s.payload}).addCase(t.rejected,(e,s)=>{e.isLoading=!1,e.error=s.payload}).addCase(n.pending,e=>{e.isUpdating=!0,e.error=null}).addCase(n.fulfilled,(e,s)=>{e.isUpdating=!1;let a=e.roles.findIndex(e=>e._id===s.payload._id);-1!==a&&(e.roles[a]=s.payload)}).addCase(n.rejected,(e,s)=>{e.isUpdating=!1,e.error=s.payload})}}).reducer},55496:(e,s,a)=>{Promise.resolve().then(a.bind(a,89507))},89507:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>b});var i=a(95155),r=a(12115),t=a(66695),n=a(30285),l=a(76981),d=a(10518),c=a(59434);let o=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,i.jsx)(l.bL,{ref:s,className:(0,c.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",a),...r,children:(0,i.jsx)(l.C1,{className:(0,c.cn)("flex items-center justify-center text-current"),children:(0,i.jsx)(d.A,{className:"h-4 w-4"})})})});o.displayName=l.bL.displayName;var m=a(85057),u=a(87481),h=a(34540),p=a(16674),g=a(18271),f=a(50172),x=a(59119),j=a(67792),N=a(68856);let v=[{id:"/dashboard",label:"Dashboard"},{id:"/socialmedia",label:"Social Media"},{id:"/email",label:"Email"},{id:"/google-ads",label:"Google Ads"}];function y(){return(0,i.jsx)("div",{className:"space-y-4",children:[void 0,void 0,void 0].map((e,s)=>(0,i.jsxs)("div",{className:"flex items-start space-x-4 p-4 border-b",children:[(0,i.jsxs)("div",{className:"w-1/4 space-y-2",children:[(0,i.jsx)(N.E,{className:"h-5 w-24"}),(0,i.jsx)(N.E,{className:"h-4 w-48"})]}),(0,i.jsx)("div",{className:"w-3/4 grid grid-cols-2 sm:grid-cols-3 gap-6",children:[...Array(6)].map((e,s)=>(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(N.E,{className:"size-4"}),(0,i.jsx)(N.E,{className:"h-4 w-20"})]},s))})]},s))})}function b(){let e=(0,h.wA)(),{roles:s,isLoading:a,isUpdating:l,error:d}=(0,h.d4)(e=>e.settings),{toast:c}=(0,u.dj)(),[N,b]=(0,r.useState)([]),w=(0,r.useMemo)(()=>0!==N.length&&0!==s.length&&N.some(e=>{let a=s.find(s=>s._id===e._id);if(!a)return!1;let i=[...e.permissions||[]].sort(),r=[...a.permissions||[]].sort();return JSON.stringify(i)!==JSON.stringify(r)}),[N,s]);(0,r.useEffect)(()=>{e((0,p.kN)())},[e]),(0,r.useEffect)(()=>{b(s.filter(e=>"Super Admin"!==e.name))},[s]);let C=(e,s,a)=>{b(i=>i.map(i=>{if(i._id===e){let e=i.permissions||[],r=a?[...e,s]:e.filter(e=>e!==s);return{...i,permissions:r}}return i}))},A=async()=>{let a=N.filter(e=>{let a=s.find(s=>s._id===e._id);if(!a)return!1;let i=[...e.permissions||[]].sort(),r=[...a.permissions||[]].sort();return JSON.stringify(i)!==JSON.stringify(r)});if(0===a.length)return void c({title:"No changes to save.",variant:"info"});let i=a.map(s=>e((0,p.Ul)({roleId:s._id,permissions:s.permissions})));try{await Promise.all(i),c({title:"Permissions Updated",description:"Successfully saved changes for ".concat(a.length," role(s)."),variant:"success"})}catch(e){c({title:"Update Failed",description:"An error occurred while saving the permissions.",variant:"destructive"})}},_=(0,r.useMemo)(()=>[{accessorKey:"name",header:"Role",cell:e=>{let{row:s}=e,a=s.original;return(0,i.jsxs)("div",{className:"font-medium align-top",children:[(0,i.jsx)("p",{className:"font-semibold",children:a.name}),(0,i.jsx)("p",{className:"text-sm text-muted-foreground",children:a.description})]})}},{accessorKey:"permissions",header:"Permissions",cell:e=>{let{row:s}=e,a=s.original;return(0,i.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-x-6 gap-y-4",children:v.map(e=>(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(o,{id:"".concat(a._id,"-").concat(e.id),checked:(a.permissions||[]).includes(e.id),onCheckedChange:s=>C(a._id,e.id,!!s),disabled:l}),(0,i.jsx)(m.J,{htmlFor:"".concat(a._id,"-").concat(e.id),className:"font-normal",children:e.label})]},e.id))})}}],[l,s]);return(0,i.jsxs)("main",{className:"flex flex-1 flex-col gap-6 p-4 sm:px-6 md:gap-8 md:p-8",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)("h1",{className:"flex items-center gap-2 text-2xl font-headline font-semibold",children:[(0,i.jsx)(g.A,{className:"size-8"}),"Settings"]}),(0,i.jsx)("p",{className:"text-muted-foreground",children:"Manage application-wide settings. Changes will take effect on the user's next login."})]}),(0,i.jsxs)(t.Zp,{children:[(0,i.jsxs)(t.aR,{children:[(0,i.jsx)(t.ZB,{children:"Role-Based Access Control"}),(0,i.jsx)(t.BT,{children:"Define which pages each user role can access. The Super Admin role has full access and cannot be modified."})]}),(0,i.jsx)(t.Wu,{children:a&&0===N.length?(0,i.jsx)(y,{}):(0,i.jsx)(j.b,{columns:_,data:N,isLoading:!1,error:d,pageCount:1,currentPage:1,onPageChange:()=>{},currentLimit:N.length||5,onLimitChange:()=>{},hidePagination:!1,children:(0,i.jsx)("div",{})})}),(0,i.jsx)(t.wL,{className:"justify-end pt-6",children:(0,i.jsxs)(n.$,{onClick:A,disabled:l||!w,children:[l&&(0,i.jsx)(f.A,{className:"mr-2 h-4 w-4 animate-spin"}),(0,i.jsx)(x.A,{className:"mr-2 h-4 w-4"}),"Save All Changes"]})})]})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[4277,6663,6439,4540,2688,8034,7922,4602,3242,7028,8441,1684,7358],()=>s(55496)),_N_E=e.O()}]);